<!DOCTYPE html>
<!-- saved from url=(0119)https://coral.googlesource.com/linux-imx/+/refs/heads/alpha/drivers/input/touchscreen/tsc40.c?autodive=0%2F%2F%2F%2F%2F -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>drivers/input/touchscreen/tsc40.c - linux-imx - Git at Google</title><link rel="stylesheet" type="text/css" href="./drivers_input_touchscreen_tsc40.c - linux-imx - Git at Google_files/base.css"><link rel="stylesheet" type="text/css" href="./drivers_input_touchscreen_tsc40.c - linux-imx - Git at Google_files/prettify.css"><!-- default customHeadTagPart --></head><body class="Site"><header class="Site-header"><div class="Header"><a class="Header-image" href="https://coral.googlesource.com/"><img src="./drivers_input_touchscreen_tsc40.c - linux-imx - Git at Google_files/lockup_git_color_108x24dp.png" width="108" height="24" alt="Google Git"></a><div class="Header-menu"> <a class="Header-menuItem" href="https://accounts.google.com/AccountChooser?faa=1&amp;continue=https://coral.googlesource.com/login/linux-imx/%2B/refs/heads/alpha/drivers/input/touchscreen/tsc40.c?autodive%3D0%252F%252F%252F%252F%252F">Sign in</a> </div></div></header><div class="Site-content"><div class="Container "><div class="Breadcrumbs"><a class="Breadcrumbs-crumb" href="https://coral.googlesource.com/?format=HTML">coral</a> / <a class="Breadcrumbs-crumb" href="https://coral.googlesource.com/linux-imx/">linux-imx</a> / <a class="Breadcrumbs-crumb" href="https://coral.googlesource.com/linux-imx/+/refs/heads/alpha">refs/heads/alpha</a> / <a class="Breadcrumbs-crumb" href="https://coral.googlesource.com/linux-imx/+/refs/heads/alpha/?autodive=0%2F%2F%2F%2F%2F">.</a> / <a class="Breadcrumbs-crumb" href="https://coral.googlesource.com/linux-imx/+/refs/heads/alpha/drivers?autodive=0%2F%2F%2F%2F%2F">drivers</a> / <a class="Breadcrumbs-crumb" href="https://coral.googlesource.com/linux-imx/+/refs/heads/alpha/drivers/input?autodive=0%2F%2F%2F%2F%2F">input</a> / <a class="Breadcrumbs-crumb" href="https://coral.googlesource.com/linux-imx/+/refs/heads/alpha/drivers/input/touchscreen?autodive=0%2F%2F%2F%2F%2F">touchscreen</a> / <span class="Breadcrumbs-crumb">tsc40.c</span></div><div class="u-sha1 u-monospace BlobSha1">blob: 29687872cb945356253b0dd017f74cb0a0acc3ef [<a href="https://coral.googlesource.com/linux-imx/+/refs/heads/alpha/drivers/input/touchscreen/tsc40.c?autodive=0%2F%2F%2F%2F%2F">file</a>] [<a href="https://coral.googlesource.com/linux-imx/+log/refs/heads/alpha/drivers/input/touchscreen/tsc40.c">log</a>] [<a href="https://coral.googlesource.com/linux-imx/+blame/refs/heads/alpha/drivers/input/touchscreen/tsc40.c">blame</a>] [<a href="https://coral-review.googlesource.com/admin/repos/edit/repo/linux-imx/branch/refs/heads/alpha/file/drivers/input/touchscreen/tsc40.c">edit</a>]</div><table class="FileContents"><tbody><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="1"></td><td class="FileContents-lineContents" id="1"><span class="com">/*</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="2"></td><td class="FileContents-lineContents" id="2"><span class="com"> * TSC-40 serial touchscreen driver. It should be compatible with</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="3"></td><td class="FileContents-lineContents" id="3"><span class="com"> * TSC-10 and 25.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="4"></td><td class="FileContents-lineContents" id="4"><span class="com"> *</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="5"></td><td class="FileContents-lineContents" id="5"><span class="com"> * Author: Sebastian Andrzej Siewior &lt;bigeasy@linutronix.de&gt;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="6"></td><td class="FileContents-lineContents" id="6"><span class="com"> * License: GPLv2 as published by the FSF.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="7"></td><td class="FileContents-lineContents" id="7"><span class="com"> */</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="8"></td><td class="FileContents-lineContents" id="8"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="9"></td><td class="FileContents-lineContents" id="9"><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;linux/kernel.h&gt;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="10"></td><td class="FileContents-lineContents" id="10"><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;linux/module.h&gt;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="11"></td><td class="FileContents-lineContents" id="11"><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;linux/slab.h&gt;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="12"></td><td class="FileContents-lineContents" id="12"><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;linux/input.h&gt;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="13"></td><td class="FileContents-lineContents" id="13"><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;linux/serio.h&gt;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="14"></td><td class="FileContents-lineContents" id="14"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="15"></td><td class="FileContents-lineContents" id="15"><span class="com">#define</span><span class="pln"> PACKET_LENGTH  </span><span class="lit">5</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="16"></td><td class="FileContents-lineContents" id="16"><span class="kwd">struct</span><span class="pln"> tsc_ser </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="17"></td><td class="FileContents-lineContents" id="17"><span class="pln">	</span><span class="kwd">struct</span><span class="pln"> input_dev </span><span class="pun">*</span><span class="pln">dev</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="18"></td><td class="FileContents-lineContents" id="18"><span class="pln">	</span><span class="kwd">struct</span><span class="pln"> serio </span><span class="pun">*</span><span class="pln">serio</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="19"></td><td class="FileContents-lineContents" id="19"><span class="pln">	u32 idx</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="20"></td><td class="FileContents-lineContents" id="20"><span class="pln">	</span><span class="kwd">unsigned</span><span class="pln"> </span><span class="kwd">char</span><span class="pln"> data</span><span class="pun">[</span><span class="pln">PACKET_LENGTH</span><span class="pun">];</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="21"></td><td class="FileContents-lineContents" id="21"><span class="pln">	</span><span class="kwd">char</span><span class="pln"> phys</span><span class="pun">[</span><span class="lit">32</span><span class="pun">];</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="22"></td><td class="FileContents-lineContents" id="22"><span class="pun">};</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="23"></td><td class="FileContents-lineContents" id="23"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="24"></td><td class="FileContents-lineContents" id="24"><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> tsc_process_data</span><span class="pun">(</span><span class="kwd">struct</span><span class="pln"> tsc_ser </span><span class="pun">*</span><span class="pln">ptsc</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="25"></td><td class="FileContents-lineContents" id="25"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="26"></td><td class="FileContents-lineContents" id="26"><span class="pln">	</span><span class="kwd">struct</span><span class="pln"> input_dev </span><span class="pun">*</span><span class="pln">dev </span><span class="pun">=</span><span class="pln"> ptsc</span><span class="pun">-&gt;</span><span class="pln">dev</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="27"></td><td class="FileContents-lineContents" id="27"><span class="pln">	u8 </span><span class="pun">*</span><span class="pln">data </span><span class="pun">=</span><span class="pln"> ptsc</span><span class="pun">-&gt;</span><span class="pln">data</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="28"></td><td class="FileContents-lineContents" id="28"><span class="pln">	u32 x</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="29"></td><td class="FileContents-lineContents" id="29"><span class="pln">	u32 y</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="30"></td><td class="FileContents-lineContents" id="30"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="31"></td><td class="FileContents-lineContents" id="31"><span class="pln">	x </span><span class="pun">=</span><span class="pln"> </span><span class="pun">((</span><span class="pln">data</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0x03</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">8</span><span class="pun">)</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> data</span><span class="pun">[</span><span class="lit">2</span><span class="pun">];</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="32"></td><td class="FileContents-lineContents" id="32"><span class="pln">	y </span><span class="pun">=</span><span class="pln"> </span><span class="pun">((</span><span class="pln">data</span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0x03</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">8</span><span class="pun">)</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> data</span><span class="pun">[</span><span class="lit">4</span><span class="pun">];</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="33"></td><td class="FileContents-lineContents" id="33"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="34"></td><td class="FileContents-lineContents" id="34"><span class="pln">	input_report_abs</span><span class="pun">(</span><span class="pln">dev</span><span class="pun">,</span><span class="pln"> ABS_X</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="35"></td><td class="FileContents-lineContents" id="35"><span class="pln">	input_report_abs</span><span class="pun">(</span><span class="pln">dev</span><span class="pun">,</span><span class="pln"> ABS_Y</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="36"></td><td class="FileContents-lineContents" id="36"><span class="pln">	input_report_key</span><span class="pun">(</span><span class="pln">dev</span><span class="pun">,</span><span class="pln"> BTN_TOUCH</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="37"></td><td class="FileContents-lineContents" id="37"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="38"></td><td class="FileContents-lineContents" id="38"><span class="pln">	input_sync</span><span class="pun">(</span><span class="pln">dev</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="39"></td><td class="FileContents-lineContents" id="39"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="40"></td><td class="FileContents-lineContents" id="40"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="41"></td><td class="FileContents-lineContents" id="41"><span class="kwd">static</span><span class="pln"> </span><span class="typ">irqreturn_t</span><span class="pln"> tsc_interrupt</span><span class="pun">(</span><span class="kwd">struct</span><span class="pln"> serio </span><span class="pun">*</span><span class="pln">serio</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="42"></td><td class="FileContents-lineContents" id="42"><span class="pln">		</span><span class="kwd">unsigned</span><span class="pln"> </span><span class="kwd">char</span><span class="pln"> data</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">unsigned</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> flags</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="43"></td><td class="FileContents-lineContents" id="43"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="44"></td><td class="FileContents-lineContents" id="44"><span class="pln">	</span><span class="kwd">struct</span><span class="pln"> tsc_ser </span><span class="pun">*</span><span class="pln">ptsc </span><span class="pun">=</span><span class="pln"> serio_get_drvdata</span><span class="pun">(</span><span class="pln">serio</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="45"></td><td class="FileContents-lineContents" id="45"><span class="pln">	</span><span class="kwd">struct</span><span class="pln"> input_dev </span><span class="pun">*</span><span class="pln">dev </span><span class="pun">=</span><span class="pln"> ptsc</span><span class="pun">-&gt;</span><span class="pln">dev</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="46"></td><td class="FileContents-lineContents" id="46"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="47"></td><td class="FileContents-lineContents" id="47"><span class="pln">	ptsc</span><span class="pun">-&gt;</span><span class="pln">data</span><span class="pun">[</span><span class="pln">ptsc</span><span class="pun">-&gt;</span><span class="pln">idx</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> data</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="48"></td><td class="FileContents-lineContents" id="48"><span class="pln">	</span><span class="kwd">switch</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ptsc</span><span class="pun">-&gt;</span><span class="pln">idx</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="49"></td><td class="FileContents-lineContents" id="49"><span class="pln">	</span><span class="kwd">case</span><span class="pln"> </span><span class="lit">0</span><span class="pun">:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="50"></td><td class="FileContents-lineContents" id="50"><span class="pln">		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">unlikely</span><span class="pun">((</span><span class="pln">data </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0x3e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0x10</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="51"></td><td class="FileContents-lineContents" id="51"><span class="pln">			dev_dbg</span><span class="pun">(&amp;</span><span class="pln">serio</span><span class="pun">-&gt;</span><span class="pln">dev</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="52"></td><td class="FileContents-lineContents" id="52"><span class="pln">				</span><span class="str">"unsynchronized packet start (0x%02x)\n"</span><span class="pun">,</span><span class="pln"> data</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="53"></td><td class="FileContents-lineContents" id="53"><span class="pln">			ptsc</span><span class="pun">-&gt;</span><span class="pln">idx </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="54"></td><td class="FileContents-lineContents" id="54"><span class="pln">		</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!(</span><span class="pln">data </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0x01</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="55"></td><td class="FileContents-lineContents" id="55"><span class="pln">			input_report_key</span><span class="pun">(</span><span class="pln">dev</span><span class="pun">,</span><span class="pln"> BTN_TOUCH</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="56"></td><td class="FileContents-lineContents" id="56"><span class="pln">			input_sync</span><span class="pun">(</span><span class="pln">dev</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="57"></td><td class="FileContents-lineContents" id="57"><span class="pln">			ptsc</span><span class="pun">-&gt;</span><span class="pln">idx </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="58"></td><td class="FileContents-lineContents" id="58"><span class="pln">		</span><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="59"></td><td class="FileContents-lineContents" id="59"><span class="pln">		</span><span class="kwd">break</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="60"></td><td class="FileContents-lineContents" id="60"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="61"></td><td class="FileContents-lineContents" id="61"><span class="pln">	</span><span class="kwd">case</span><span class="pln"> </span><span class="lit">1</span><span class="pun">:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="62"></td><td class="FileContents-lineContents" id="62"><span class="pln">	</span><span class="kwd">case</span><span class="pln"> </span><span class="lit">3</span><span class="pun">:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="63"></td><td class="FileContents-lineContents" id="63"><span class="pln">		</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">unlikely</span><span class="pun">(</span><span class="pln">data </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">0xfc</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="64"></td><td class="FileContents-lineContents" id="64"><span class="pln">			dev_dbg</span><span class="pun">(&amp;</span><span class="pln">serio</span><span class="pun">-&gt;</span><span class="pln">dev</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="65"></td><td class="FileContents-lineContents" id="65"><span class="pln">				</span><span class="str">"unsynchronized data 0x%02x at offset %d\n"</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="66"></td><td class="FileContents-lineContents" id="66"><span class="pln">				data</span><span class="pun">,</span><span class="pln"> ptsc</span><span class="pun">-&gt;</span><span class="pln">idx </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="67"></td><td class="FileContents-lineContents" id="67"><span class="pln">			ptsc</span><span class="pun">-&gt;</span><span class="pln">idx </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="68"></td><td class="FileContents-lineContents" id="68"><span class="pln">		</span><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="69"></td><td class="FileContents-lineContents" id="69"><span class="pln">		</span><span class="kwd">break</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="70"></td><td class="FileContents-lineContents" id="70"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="71"></td><td class="FileContents-lineContents" id="71"><span class="pln">	</span><span class="kwd">case</span><span class="pln"> </span><span class="lit">4</span><span class="pun">:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="72"></td><td class="FileContents-lineContents" id="72"><span class="pln">		tsc_process_data</span><span class="pun">(</span><span class="pln">ptsc</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="73"></td><td class="FileContents-lineContents" id="73"><span class="pln">		ptsc</span><span class="pun">-&gt;</span><span class="pln">idx </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="74"></td><td class="FileContents-lineContents" id="74"><span class="pln">		</span><span class="kwd">break</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="75"></td><td class="FileContents-lineContents" id="75"><span class="pln">	</span><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="76"></td><td class="FileContents-lineContents" id="76"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="77"></td><td class="FileContents-lineContents" id="77"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> IRQ_HANDLED</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="78"></td><td class="FileContents-lineContents" id="78"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="79"></td><td class="FileContents-lineContents" id="79"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="80"></td><td class="FileContents-lineContents" id="80"><span class="kwd">static</span><span class="pln"> </span><span class="typ">int</span><span class="pln"> tsc_connect</span><span class="pun">(</span><span class="kwd">struct</span><span class="pln"> serio </span><span class="pun">*</span><span class="pln">serio</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">struct</span><span class="pln"> serio_driver </span><span class="pun">*</span><span class="pln">drv</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="81"></td><td class="FileContents-lineContents" id="81"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="82"></td><td class="FileContents-lineContents" id="82"><span class="pln">	</span><span class="kwd">struct</span><span class="pln"> tsc_ser </span><span class="pun">*</span><span class="pln">ptsc</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="83"></td><td class="FileContents-lineContents" id="83"><span class="pln">	</span><span class="kwd">struct</span><span class="pln"> input_dev </span><span class="pun">*</span><span class="pln">input_dev</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="84"></td><td class="FileContents-lineContents" id="84"><span class="pln">	</span><span class="typ">int</span><span class="pln"> error</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="85"></td><td class="FileContents-lineContents" id="85"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="86"></td><td class="FileContents-lineContents" id="86"><span class="pln">	ptsc </span><span class="pun">=</span><span class="pln"> kzalloc</span><span class="pun">(</span><span class="kwd">sizeof</span><span class="pun">(</span><span class="kwd">struct</span><span class="pln"> tsc_ser</span><span class="pun">),</span><span class="pln"> GFP_KERNEL</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="87"></td><td class="FileContents-lineContents" id="87"><span class="pln">	input_dev </span><span class="pun">=</span><span class="pln"> input_allocate_device</span><span class="pun">();</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="88"></td><td class="FileContents-lineContents" id="88"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">ptsc </span><span class="pun">||</span><span class="pln"> </span><span class="pun">!</span><span class="pln">input_dev</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="89"></td><td class="FileContents-lineContents" id="89"><span class="pln">		error </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="pln">ENOMEM</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="90"></td><td class="FileContents-lineContents" id="90"><span class="pln">		</span><span class="kwd">goto</span><span class="pln"> fail1</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="91"></td><td class="FileContents-lineContents" id="91"><span class="pln">	</span><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="92"></td><td class="FileContents-lineContents" id="92"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="93"></td><td class="FileContents-lineContents" id="93"><span class="pln">	ptsc</span><span class="pun">-&gt;</span><span class="pln">serio </span><span class="pun">=</span><span class="pln"> serio</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="94"></td><td class="FileContents-lineContents" id="94"><span class="pln">	ptsc</span><span class="pun">-&gt;</span><span class="pln">dev </span><span class="pun">=</span><span class="pln"> input_dev</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="95"></td><td class="FileContents-lineContents" id="95"><span class="pln">	snprintf</span><span class="pun">(</span><span class="pln">ptsc</span><span class="pun">-&gt;</span><span class="pln">phys</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">sizeof</span><span class="pun">(</span><span class="pln">ptsc</span><span class="pun">-&gt;</span><span class="pln">phys</span><span class="pun">),</span><span class="pln"> </span><span class="str">"%s/input0"</span><span class="pun">,</span><span class="pln"> serio</span><span class="pun">-&gt;</span><span class="pln">phys</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="96"></td><td class="FileContents-lineContents" id="96"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="97"></td><td class="FileContents-lineContents" id="97"><span class="pln">	input_dev</span><span class="pun">-&gt;</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"TSC-10/25/40 Serial TouchScreen"</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="98"></td><td class="FileContents-lineContents" id="98"><span class="pln">	input_dev</span><span class="pun">-&gt;</span><span class="pln">phys </span><span class="pun">=</span><span class="pln"> ptsc</span><span class="pun">-&gt;</span><span class="pln">phys</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="99"></td><td class="FileContents-lineContents" id="99"><span class="pln">	input_dev</span><span class="pun">-&gt;</span><span class="pln">id</span><span class="pun">.</span><span class="pln">bustype </span><span class="pun">=</span><span class="pln"> BUS_RS232</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="100"></td><td class="FileContents-lineContents" id="100"><span class="pln">	input_dev</span><span class="pun">-&gt;</span><span class="pln">id</span><span class="pun">.</span><span class="pln">vendor </span><span class="pun">=</span><span class="pln"> SERIO_TSC40</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="101"></td><td class="FileContents-lineContents" id="101"><span class="pln">	input_dev</span><span class="pun">-&gt;</span><span class="pln">id</span><span class="pun">.</span><span class="pln">product </span><span class="pun">=</span><span class="pln"> </span><span class="lit">40</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="102"></td><td class="FileContents-lineContents" id="102"><span class="pln">	input_dev</span><span class="pun">-&gt;</span><span class="pln">id</span><span class="pun">.</span><span class="pln">version </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0x0001</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="103"></td><td class="FileContents-lineContents" id="103"><span class="pln">	input_dev</span><span class="pun">-&gt;</span><span class="pln">dev</span><span class="pun">.</span><span class="pln">parent </span><span class="pun">=</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">serio</span><span class="pun">-&gt;</span><span class="pln">dev</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="104"></td><td class="FileContents-lineContents" id="104"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="105"></td><td class="FileContents-lineContents" id="105"><span class="pln">	input_dev</span><span class="pun">-&gt;</span><span class="pln">evbit</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> BIT_MASK</span><span class="pun">(</span><span class="pln">EV_KEY</span><span class="pun">)</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> BIT_MASK</span><span class="pun">(</span><span class="pln">EV_ABS</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="106"></td><td class="FileContents-lineContents" id="106"><span class="pln">	__set_bit</span><span class="pun">(</span><span class="pln">BTN_TOUCH</span><span class="pun">,</span><span class="pln"> input_dev</span><span class="pun">-&gt;</span><span class="pln">keybit</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="107"></td><td class="FileContents-lineContents" id="107"><span class="pln">	input_set_abs_params</span><span class="pun">(</span><span class="pln">ptsc</span><span class="pun">-&gt;</span><span class="pln">dev</span><span class="pun">,</span><span class="pln"> ABS_X</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0x3ff</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="108"></td><td class="FileContents-lineContents" id="108"><span class="pln">	input_set_abs_params</span><span class="pun">(</span><span class="pln">ptsc</span><span class="pun">-&gt;</span><span class="pln">dev</span><span class="pun">,</span><span class="pln"> ABS_Y</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0x3ff</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="109"></td><td class="FileContents-lineContents" id="109"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="110"></td><td class="FileContents-lineContents" id="110"><span class="pln">	serio_set_drvdata</span><span class="pun">(</span><span class="pln">serio</span><span class="pun">,</span><span class="pln"> ptsc</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="111"></td><td class="FileContents-lineContents" id="111"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="112"></td><td class="FileContents-lineContents" id="112"><span class="pln">	error </span><span class="pun">=</span><span class="pln"> serio_open</span><span class="pun">(</span><span class="pln">serio</span><span class="pun">,</span><span class="pln"> drv</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="113"></td><td class="FileContents-lineContents" id="113"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">error</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="114"></td><td class="FileContents-lineContents" id="114"><span class="pln">		</span><span class="kwd">goto</span><span class="pln"> fail2</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="115"></td><td class="FileContents-lineContents" id="115"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="116"></td><td class="FileContents-lineContents" id="116"><span class="pln">	error </span><span class="pun">=</span><span class="pln"> input_register_device</span><span class="pun">(</span><span class="pln">ptsc</span><span class="pun">-&gt;</span><span class="pln">dev</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="117"></td><td class="FileContents-lineContents" id="117"><span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">error</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="118"></td><td class="FileContents-lineContents" id="118"><span class="pln">		</span><span class="kwd">goto</span><span class="pln"> fail3</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="119"></td><td class="FileContents-lineContents" id="119"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="120"></td><td class="FileContents-lineContents" id="120"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="121"></td><td class="FileContents-lineContents" id="121"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="122"></td><td class="FileContents-lineContents" id="122"><span class="pln">fail3</span><span class="pun">:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="123"></td><td class="FileContents-lineContents" id="123"><span class="pln">	serio_close</span><span class="pun">(</span><span class="pln">serio</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="124"></td><td class="FileContents-lineContents" id="124"><span class="pln">fail2</span><span class="pun">:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="125"></td><td class="FileContents-lineContents" id="125"><span class="pln">	serio_set_drvdata</span><span class="pun">(</span><span class="pln">serio</span><span class="pun">,</span><span class="pln"> NULL</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="126"></td><td class="FileContents-lineContents" id="126"><span class="pln">fail1</span><span class="pun">:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="127"></td><td class="FileContents-lineContents" id="127"><span class="pln">	input_free_device</span><span class="pun">(</span><span class="pln">input_dev</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="128"></td><td class="FileContents-lineContents" id="128"><span class="pln">	kfree</span><span class="pun">(</span><span class="pln">ptsc</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="129"></td><td class="FileContents-lineContents" id="129"><span class="pln">	</span><span class="kwd">return</span><span class="pln"> error</span><span class="pun">;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="130"></td><td class="FileContents-lineContents" id="130"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="131"></td><td class="FileContents-lineContents" id="131"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="132"></td><td class="FileContents-lineContents" id="132"><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> tsc_disconnect</span><span class="pun">(</span><span class="kwd">struct</span><span class="pln"> serio </span><span class="pun">*</span><span class="pln">serio</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="133"></td><td class="FileContents-lineContents" id="133"><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="134"></td><td class="FileContents-lineContents" id="134"><span class="pln">	</span><span class="kwd">struct</span><span class="pln"> tsc_ser </span><span class="pun">*</span><span class="pln">ptsc </span><span class="pun">=</span><span class="pln"> serio_get_drvdata</span><span class="pun">(</span><span class="pln">serio</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="135"></td><td class="FileContents-lineContents" id="135"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="136"></td><td class="FileContents-lineContents" id="136"><span class="pln">	serio_close</span><span class="pun">(</span><span class="pln">serio</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="137"></td><td class="FileContents-lineContents" id="137"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="138"></td><td class="FileContents-lineContents" id="138"><span class="pln">	input_unregister_device</span><span class="pun">(</span><span class="pln">ptsc</span><span class="pun">-&gt;</span><span class="pln">dev</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="139"></td><td class="FileContents-lineContents" id="139"><span class="pln">	kfree</span><span class="pun">(</span><span class="pln">ptsc</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="140"></td><td class="FileContents-lineContents" id="140"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="141"></td><td class="FileContents-lineContents" id="141"><span class="pln">	serio_set_drvdata</span><span class="pun">(</span><span class="pln">serio</span><span class="pun">,</span><span class="pln"> NULL</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="142"></td><td class="FileContents-lineContents" id="142"><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="143"></td><td class="FileContents-lineContents" id="143"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="144"></td><td class="FileContents-lineContents" id="144"><span class="kwd">static</span><span class="pln"> </span><span class="kwd">struct</span><span class="pln"> serio_device_id tsc_serio_ids</span><span class="pun">[]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="145"></td><td class="FileContents-lineContents" id="145"><span class="pln">	</span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="146"></td><td class="FileContents-lineContents" id="146"><span class="pln">		</span><span class="pun">.</span><span class="pln">type   </span><span class="pun">=</span><span class="pln"> SERIO_RS232</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="147"></td><td class="FileContents-lineContents" id="147"><span class="pln">		</span><span class="pun">.</span><span class="pln">proto  </span><span class="pun">=</span><span class="pln"> SERIO_TSC40</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="148"></td><td class="FileContents-lineContents" id="148"><span class="pln">		</span><span class="pun">.</span><span class="pln">id     </span><span class="pun">=</span><span class="pln"> SERIO_ANY</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="149"></td><td class="FileContents-lineContents" id="149"><span class="pln">		</span><span class="pun">.</span><span class="pln">extra  </span><span class="pun">=</span><span class="pln"> SERIO_ANY</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="150"></td><td class="FileContents-lineContents" id="150"><span class="pln">	</span><span class="pun">},</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="151"></td><td class="FileContents-lineContents" id="151"><span class="pln">	</span><span class="pun">{</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">}</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="152"></td><td class="FileContents-lineContents" id="152"><span class="pun">};</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="153"></td><td class="FileContents-lineContents" id="153"><span class="pln">MODULE_DEVICE_TABLE</span><span class="pun">(</span><span class="pln">serio</span><span class="pun">,</span><span class="pln"> tsc_serio_ids</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="154"></td><td class="FileContents-lineContents" id="154"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="155"></td><td class="FileContents-lineContents" id="155"><span class="com">#define</span><span class="pln"> DRIVER_DESC    </span><span class="str">"TSC-10/25/40 serial touchscreen driver"</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="156"></td><td class="FileContents-lineContents" id="156"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="157"></td><td class="FileContents-lineContents" id="157"><span class="kwd">static</span><span class="pln"> </span><span class="kwd">struct</span><span class="pln"> serio_driver tsc_drv </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="158"></td><td class="FileContents-lineContents" id="158"><span class="pln">	</span><span class="pun">.</span><span class="pln">driver	</span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="159"></td><td class="FileContents-lineContents" id="159"><span class="pln">		</span><span class="pun">.</span><span class="pln">name   </span><span class="pun">=</span><span class="pln"> </span><span class="str">"tsc40"</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="160"></td><td class="FileContents-lineContents" id="160"><span class="pln">	</span><span class="pun">},</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="161"></td><td class="FileContents-lineContents" id="161"><span class="pln">	</span><span class="pun">.</span><span class="pln">description    </span><span class="pun">=</span><span class="pln"> DRIVER_DESC</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="162"></td><td class="FileContents-lineContents" id="162"><span class="pln">	</span><span class="pun">.</span><span class="pln">id_table	</span><span class="pun">=</span><span class="pln"> tsc_serio_ids</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="163"></td><td class="FileContents-lineContents" id="163"><span class="pln">	</span><span class="pun">.</span><span class="pln">interrupt      </span><span class="pun">=</span><span class="pln"> tsc_interrupt</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="164"></td><td class="FileContents-lineContents" id="164"><span class="pln">	</span><span class="pun">.</span><span class="pln">connect	</span><span class="pun">=</span><span class="pln"> tsc_connect</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="165"></td><td class="FileContents-lineContents" id="165"><span class="pln">	</span><span class="pun">.</span><span class="pln">disconnect     </span><span class="pun">=</span><span class="pln"> tsc_disconnect</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="166"></td><td class="FileContents-lineContents" id="166"><span class="pun">};</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="167"></td><td class="FileContents-lineContents" id="167"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="168"></td><td class="FileContents-lineContents" id="168"><span class="pln">module_serio_driver</span><span class="pun">(</span><span class="pln">tsc_drv</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="169"></td><td class="FileContents-lineContents" id="169"></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="170"></td><td class="FileContents-lineContents" id="170"><span class="pln">MODULE_AUTHOR</span><span class="pun">(</span><span class="str">"Sebastian Andrzej Siewior &lt;bigeasy@linutronix.de&gt;"</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="171"></td><td class="FileContents-lineContents" id="171"><span class="pln">MODULE_DESCRIPTION</span><span class="pun">(</span><span class="pln">DRIVER_DESC</span><span class="pun">);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="172"></td><td class="FileContents-lineContents" id="172"><span class="pln">MODULE_LICENSE</span><span class="pun">(</span><span class="str">"GPL v2"</span><span class="pun">);</span></td></tr></tbody></table><script nonce="">for (let lineNumEl of document.querySelectorAll('td.u-lineNum')) {lineNumEl.onclick = () => {window.location.hash = `#${lineNumEl.getAttribute('data-line-number')}`;};}</script></div> <!-- Container --></div> <!-- Site-content --><footer class="Site-footer"><div class="Footer"><span class="Footer-poweredBy">Powered by <a href="https://gerrit.googlesource.com/gitiles/">Gitiles</a>| <a href="https://policies.google.com/privacy">Privacy</a>| <a href="https://policies.google.com/terms">Terms</a></span><span class="Footer-formats"><a class="u-monospace Footer-formatsItem" href="https://coral.googlesource.com/linux-imx/+/refs/heads/alpha/drivers/input/touchscreen/tsc40.c?format=TEXT">txt</a> <a class="u-monospace Footer-formatsItem" href="https://coral.googlesource.com/linux-imx/+/refs/heads/alpha/drivers/input/touchscreen/tsc40.c?format=JSON">json</a></span></div></footer></body></html>